{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Venue</title>
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/homenew.style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/venue.css' %}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        input[type="checkbox"] {
           
           
            width: auto !important;
            height: auto !important;
            padding:8px !important;
        }
        input[type="file"],
        select {
            padding: 10px !important;
            border: 1px solid #ddd !important;
            width: 97% !important;
        }
       
     
            .thumbnail {
                position: relative;
                width: 120px;
                height: 100px;
                border: 1px solid #ccc;
                border-radius: 8px;
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        
            .thumbnail img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
        
            .remove-btn {
                position: absolute;
                top: 0px;
                right: 0px;
                background: red;
                color: white;
                border-radius: 50%;
                padding: 2px 6px;
                font-size: 14px;
                cursor: pointer;
                z-index: 2;
            }
            .form-error {
                color: #d9534f;
                font-size: 14px;
                margin-top: 5px;
                display: block;
            }
        
            input.error, textarea.error, select.error {
                border-color: #d9534f !important;
                background-color: rgba(217, 83, 79, 0.05);
            }
        
            .form-group {
                position: relative;
                margin-bottom: 20px;
            }
        
            /* Style for required fields */
            .required-field::after {
                content: '*';
                color: #d9534f;
                margin-left: 4px;
            }
        
          
        
            /* Image preview container styling */
            #previewContainer {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                margin-top: 15px;
            }
        
            .image-preview {
                position: relative;
                border: 1px solid #ddd;
                border-radius: 4px;
                overflow: hidden;
            }
        
            #errorText {
                color: #d9534f;
                font-weight: 500;
                margin-top: 10px;
                display: block;
            }
            .spinner {
                display: inline-block;
                width: 20px;
                height: 20px;
                border: 2px solid rgba(255,255,255,0.3);
                border-radius: 50%;
                border-top-color: #fff;
                animation: spin 1s ease-in-out infinite;
                margin-right: 8px;
            }
            
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            .form-navigation{
                float: inline-end;
                margin-top: 10px;
                display: flex ;
                    gap: 10px;
            }
            button.btn.btn-primary.next-btn{
                width:150px;
            }
            .form-section {
                display: none;
              }
              
              .form-section.active {
                display: block;
              }
              .error {
                color: red;
                font-size: 14px;
                margin-top: 5px;
              }
        </style>
   
</head>

<body>
    {% include 'header.html' %}
    <div class="container-fluid">
        <div class="row">
            {% include 'sidebar.html' %}

            <div class="col-md-10 main-form">
                {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                    <div style="color: green" class=" alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                    {% endfor %}
                </div>
                {% endif %} 

                <div class="row">
                    <div class="col-lg-3 col-md-4">
                        <div class="step_tabs">
                            <!-- Step Navigation -->
                            <div class="steps">
                                <div class="step active" data-step="1" onclick="showStep(1)"><span>01</span> Basic Information</div>
                                <div class="step" data-step="2" onclick="showStep(2)"><span>02</span> Gallery</div>
                                <div class="step" data-step="3" onclick="showStep(3)"><span>03</span> Location</div>
                                <div class="step" data-step="4" onclick="showStep(4)"><span>04</span> Amenities</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-9 col-md-8 main-form">
                      
                        <form method="post" id="venueForm" enctype="multipart/form-data">
                            {% csrf_token %}
                           
                            <!-- Step 1: Basic Information -->
                            <div class="form-section active" id="step1">
                                <div class="form-grid">
                                    <div class="form-group full">
                                        <label class="required-field">Venue Name</label>
                                        {{ form.name }}
                                        {% if form.name.errors %}
                                        <div class="error">{{ form.name.errors }}</div>
                                        {% endif %}
                                    </div>
                                   
                                    <div class="form-group full">
                                        <label class="required-field">Venue Description</label>
                                        {{ form.description }}
                                        {% if form.description.errors %}
                                        <div class="error">{{ form.description.errors }}</div>
                                        {% endif %}
                                    </div>
                                   
                                    <div style="display: flex; gap: 15px; width: 100%;" class="mobile_view">
                                        <div class="form-group" style="flex: 1;">
                                            <label>Chambermarie</label>
                                            {{ form.chambermarie }}
                                            {% if form.chambermarie.errors %}
                                            <div class="error">{{ form.chambermarie.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="form-group" style="flex: 1;">
                                            <label>Upload Chambermarie Image</label>
                                            {{ form.chambermarie_image }}
                                            {% if form.chambermarie_image.errors %}
                                            <div class="error">{{ form.chambermarie_image.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                   
                                    <div class="form-group full">
                                        <label>Select Categories</label>
                                      
                                       <div class="outer_check"> 
                                        <div class="form-check">
                                          {{ form.is_beach }}
                                          <label class="form-check-label" for="{{ form.is_beach.id_for_label }}">Beach</label>
                                        </div>
                                      
                                        <div class="form-check">
                                          {{ form.is_city }}
                                          <label class="form-check-label" for="{{ form.is_city.id_for_label }}">City</label>
                                        </div>
                                      
                                        <div class="form-check">
                                          {{ form.is_hotel }}
                                          <label class="form-check-label" for="{{ form.is_hotel.id_for_label }}">Hotel</label>
                                        </div>
                                      
                                        <div class="form-check">
                                          {{ form.is_countryside }}
                                          <label class="form-check-label" for="{{ form.is_countryside.id_for_label }}">Countryside</label>
                                        </div>
                                      
                                        <!-- ✅ New checkboxes -->
                                        <div class="form-check">
                                          {{ form.is_mountain }}
                                          <label class="form-check-label" for="{{ form.is_mountain.id_for_label }}">Mountain</label>
                                        </div>
                                      
                                        <div class="form-check">
                                          {{ form.is_resort }}
                                          <label class="form-check-label" for="{{ form.is_resort.id_for_label }}">Resort</label>
                                        </div>
                                      
                                        <div class="form-check">
                                          {{ form.is_forest }}
                                          <label class="form-check-label" for="{{ form.is_forest.id_for_label }}">Forest</label>
                                        </div>
                                        <div class="form-check">
                                            {{ form.is_rooftop }}
                                            <label class="form-check-label" for="{{ form.is_rooftop.id_for_label }}">Rooftop</label>
                                        </div>
                                        <div class="form-check">
                                            {{ form.is_garden }}
                                            <label class="form-check-label" for="{{ form.is_garden.id_for_label }}">Garden</label>
                                          </div>
                                          <div class="form-check">
                                            {{ form.is_desert }}
                                            <label class="form-check-label" for="{{ form.is_desert.id_for_label }}">Desert</label>
                                          </div>
                                          
                                          <div class="form-check">
                                            {{ form.is_lake }}
                                            <label class="form-check-label" for="{{ form.is_lake.id_for_label }}">Lake</label>
                                          </div>
                                          
                                          <div class="form-check">
                                            {{ form.is_island }}
                                            <label class="form-check-label" for="{{ form.is_island.id_for_label }}">Island</label>
                                          </div>
                                          
                                          <div class="form-check">
                                            {{ form.is_cave }}
                                            <label class="form-check-label" for="{{ form.is_cave.id_for_label }}">Cave</label>
                                          </div>
                                          
                                          <div class="form-check">
                                            {{ form.is_vineyard }}
                                            <label class="form-check-label" for="{{ form.is_vineyard.id_for_label }}">Vineyard</label>
                                          </div>
                                          
                                          </div>
                                      </div>
                                       <div style="display: flex; gap: 40px; width: 100%;">
                                        <div class="form-group" style="flex: 1;">
                                            <label class="required-field">Price</label>
                                            {{ form.price }}
                                            {% if form.price.errors %}
                                            <div class="error">{{ form.price.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="form-group" style="flex: 1;">
                                            <label class="required-field">Contact</label>
                                            {{ form.contact }}
                                            {% if form.contact.errors %}
                                            <div class="error">{{ form.contact.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div class="form-group full">
                                        <label class="required-field">Capacity</label>
                                        {{ form.capacity }}
                                        {% if form.capacity.errors %}
                                        <div class="error">{{ form.capacity.errors }}</div>
                                        {% endif %}
                                    </div>
                                    
                                </div>
                                <div class="form-navigation">
                                    <button type="button" class="btn btn-primary next-btn">Next</button>
                                  </div>
                                  
                            </div>

                            <!-- Step 2: Gallery -->
                            <div class="form-section" id="step2" style="margin-top: 30px;">
                                <div class="same_div">
                                    <label style="font-weight: 500;">Venue Thumbnail</label>
                                    {{ form.thumbnail }}
                                    {% if form.thumbnail.errors %}
                                    <div class="error">{{ form.thumbnail.errors }}</div>
                                    {% endif %}
                                    <small>* Thumbnail image is required</small>

                                    <div class="dropzone" style="float: left; margin-top: 10px;">
                                        <input type="file" name="gallery_images" multiple accept="image/*" id="galleryInput">
                                        
                                        <div id="previewContainer" style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px;"></div>
                                    
                                        <p id="errorText" style="color: red; font-weight: 500;"></p>
                                    
                                        <small>* You can upload up to 4 images for your listing(JPG, PNG,JPEG)</small><br>
                                        <small>* Listing images should be at least 620x480 in dimensions</small>
                                    </div>
                                   
                                </div>
                                <div class="form-navigation">
                                    <button type="button" class="btn btn-secondary prev-btn">Previous</button>
                                    <button type="button" class="btn btn-primary next-btn" >Next</button>
                                  </div>
                                  
                            </div>

                            <!-- Step 3: Location -->
                            <div class="form-section" id="step3">
                                <div class="location same_div">
                                   
                                    {% comment %} <div class="">
                                      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d423817.9663201953!2d18.032266843830698!3d-33.913395580156234!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1dcc500f8826eed7%3A0x687fe1fc2828aa87!2sCape%20Town%2C%20South%20Africa!5e0!3m2!1sen!2sin!4v1743676276759!5m2!1sen!2sin" width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                                           
                                       </div>
                                       <p class="text-muted">Drag and drop the marker to identify your <b>Latitude</b> and <b>Longitude</b></p>
                                        {% endcomment %}
                                        <div class="form-group mt2">
                                            <label for="fullAddress" class="required-field">Full Address</label>
                                            {{ form.full_address }}
                                            {% if form.full_address.errors %}
                                            <div class="error">{{ form.full_address.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="form-group">
                                            <label for="region" class="required-field">Region</label>
                                            {{ form.region }}
                                            {% if form.region.errors %}
                    <div class="error">{{ form.region.errors }}</div>
                    {% endif %}
                                        </div>
                                        <div class="form-row" style="display: flex; gap: 15px;">
                                            <div class="form-group" style="flex: 1;">
                                                <label for="longitude" class="required-field">Longitude</label>
                                                {{ form.longitude }}
                                                {% if form.longitude.errors %}
                                                <div class="error">{{ form.longitude.errors }}</div>
                                                {% endif %}
                                            </div>
                                            <div class="form-group" style="flex: 1;">
                                                <label for="latitude" class="required-field">Latitude</label>
                                                {{ form.latitude }}
                                                {% if form.latitude.errors %}
                        <div class="error">{{ form.latitude.errors }}</div>
                        {% endif %}
                                            </div>
                                    </div>
                                   
                                      
                                </div>
                                <div class="form-navigation">
                                    <button type="button" class="btn btn-secondary prev-btn" >Previous</button>
                                    <button type="button" class="btn btn-primary next-btn" >Next</button>
                                  </div>
                            </div>

                            <!-- Step 4: Amenities -->
                            <div class="form-section" id="step4">
                                <div class="location same_div">
                                    <div class="feature-grid">
                                        <div class="feature-box" onclick="toggleAmenity(this, 'parking')">
                                            <div class="feature-content">
                                                <i class="fas fa-parking"></i>
                                                <p>Parking</p>
                                            </div>
                                            <div class="checkbox-indicator">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="check-icon">
                                                    <polyline points="20 6 9 17 4 12"></polyline>
                                                </svg>
                                            </div>
                                            <input type="checkbox" name="amenities" value="parking" style="display:none;" {% if form.has_parking.value %}checked{% endif %}>
                                        </div>
                                       
                                        <div class="feature-box" onclick="toggleAmenity(this, 'prayer_rooms')">
                                            <div class="feature-content">
                                                <i class="fas fa-praying-hands"></i>
                                                <p>Prayer Rooms</p>
                                            </div>
                                            <div class="checkbox-indicator">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="check-icon">
                                                    <polyline points="20 6 9 17 4 12"></polyline>
                                                </svg>
                                            </div>
                                            <input type="checkbox" name="amenities" value="prayer_rooms" style="display:none;" {% if form.has_prayer_rooms.value %}checked{% endif %}>
                                        </div>
                                       
                                        <div class="feature-box" onclick="toggleAmenity(this, 'dj')">
                                            <div class="feature-content">
                                                <i class="fas fa-music"></i>
                                                <p>DJ</p>
                                            </div>
                                            <div class="checkbox-indicator">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="check-icon">
                                                    <polyline points="20 6 9 17 4 12"></polyline>
                                                </svg>
                                            </div>
                                            <input type="checkbox" name="amenities" value="dj" style="display:none;" {% if form.has_dj.value %}checked{% endif %}>
                                        </div>
                                       
                                        <div class="feature-box" onclick="toggleAmenity(this, 'photographer')">
                                            <div class="feature-content">
                                                <i class="fas fa-camera"></i>
                                                <p>Photographer</p>
                                            </div>
                                            <div class="checkbox-indicator">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="check-icon">
                                                    <polyline points="20 6 9 17 4 12"></polyline>
                                                </svg>
                                            </div>
                                            <input type="checkbox" name="amenities" value="photographer" style="display:none;" {% if form.has_photographer.value %}checked{% endif %}>
                                        </div>
                                       
                                        <div class="feature-box" onclick="toggleAmenity(this, 'wifi')">
                                            <div class="feature-content">
                                                <i class="fas fa-wifi"></i>
                                                <p>WiFi</p>
                                            </div>
                                            <div class="checkbox-indicator">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="check-icon">
                                                    <polyline points="20 6 9 17 4 12"></polyline>
                                                </svg>
                                            </div>
                                            <input type="checkbox" name="amenities" value="wifi" style="display:none;" {% if form.has_wifi.value %}checked{% endif %}>
                                        </div>
                                       
                                        <div class="feature-box" onclick="toggleAmenity(this, 'swimming_pool')">
                                            <div class="feature-content">
                                                <i class="fas fa-swimming-pool"></i>
                                                <p>Swimming Pool</p>
                                            </div>
                                            <div class="checkbox-indicator">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="check-icon">
                                                    <polyline points="20 6 9 17 4 12"></polyline>
                                                </svg>
                                            </div>
                                            <input type="checkbox" name="amenities" value="swimming_pool" style="display:none;" {% if form.has_swimming_pool.value %}checked{% endif %}>
                                        </div>
                                       
                                    </div>

                                    <div class="venue-butn d-flex justify-content-between">
                                        <button type="button" style="margin-top:20px;height:40px" class="btn btn-secondary prev-btn">Previous</button>
                                        <button type="submit" class="submitbtn">Add Venue</button>
                                    </div>
                                </div>
                            </div>
                            
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="row">
                <!-- About -->
                <div class="col-md-3">
                    <h5>About Weddlist</h5>
                    <p>Sed ut perspiciatis unde omnis iste natus error voluptatem.</p>
                    <p>Ut enim ad minima veniam, quis nostrum exercitationem ullam cor poris suscipit labo riosam.</p>
                   
                </div>
                <!-- Pages -->
                <div class="col-md-3 links">
                    <h5>Pages</h5>
                    <a href="#">Contact Us</a>
                    <a href="#">Blog</a>
                    <a href="#">Help</a>
                    <a href="#">Gallery</a>
                    <a href="#">FAQs</a>
                </div>
                <!-- Categories -->
                <div class="col-md-3 links">
                    <h5>Categories</h5>
                    <a href="#">Beauty</a>
                    <a href="#">Catering</a>
                    <a href="#">Dresses</a>
                    <a href="#">Invitations</a>
                    <a href="#">Music</a>
                </div>
                <!-- Newsletter -->
                <div class="col-md-3">
                   
                    <div class="social-icons mt-3">
                        <a href="#">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="copyright"> © 2025 All rights reserved. </div>
    </footer>
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- Bootstrap 5.3.3 JS -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <script>
        // Step navigation
        function showStep(step) {
            // Hide all sections
            document.querySelectorAll('.form-section').forEach(section => section.classList.remove('active'));
            // Show selected
            document.getElementById('step' + step).classList.add('active');
       
            // Reset all steps
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            // Activate clicked step
            document.querySelectorAll('.step')[step - 1].classList.add('active');
        }
       
        // Toggle amenity selection
        function toggleAmenity(element, amenityName) {
            element.classList.toggle('selected');
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
        }
       
        // Initialize amenities based on model values
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.feature-box').forEach(box => {
                const checkbox = box.querySelector('input[type="checkbox"]');
                if (checkbox.checked) {
                    box.classList.add('selected');
                }
            });
        });
    </script>

    <script>
        const galleryInput = document.getElementById('galleryInput');
        const previewContainer = document.getElementById('previewContainer');
        const errorText = document.getElementById('errorText');
    
        let imageFiles = [];
    
        galleryInput.addEventListener('change', function (e) {
            const files = Array.from(e.target.files);
            
            // Check total images including new ones
            if (imageFiles.length + files.length > 4) {
                errorText.textContent = "You can only upload a maximum of 4 images.";
                galleryInput.value = ""; // Reset input
                return;
            }
    
            errorText.textContent = "";
    
            files.forEach(file => {
                imageFiles.push(file);
    
                const reader = new FileReader();
                reader.onload = function (event) {
                    const thumb = document.createElement('div');
                    thumb.className = 'thumbnail';
    
                    const img = document.createElement('img');
                    img.src = event.target.result;
    
                    const removeBtn = document.createElement('span');
                    removeBtn.className = 'remove-btn';
                    removeBtn.innerHTML = '&times;';
                    removeBtn.onclick = function () {
                        previewContainer.removeChild(thumb);
                        imageFiles = imageFiles.filter(f => f !== file);
                        updateInputFiles();
                    };
    
                    thumb.appendChild(img);
                    thumb.appendChild(removeBtn);
                    previewContainer.appendChild(thumb);
                };
    
                reader.readAsDataURL(file);
            });
    
            updateInputFiles();
        });
    
        function updateInputFiles() {
            // Create a new DataTransfer to simulate the input
            const dataTransfer = new DataTransfer();
            imageFiles.forEach(file => dataTransfer.items.add(file));
            galleryInput.files = dataTransfer.files;
        }
    </script>
    {% comment %} //validation {% endcomment %}
   
   <script>
  // Wait for DOM to be fully loaded
document.addEventListener('DOMContentLoaded', function () {
    // Elements
    const formSections = document.querySelectorAll('.form-section');
    const stepButtons = document.querySelectorAll('.step');
    const nextButtons = document.querySelectorAll('.next-btn');
    const prevButtons = document.querySelectorAll('.prev-btn');
    const venueForm = document.querySelector('.main-form form') || document.getElementById('venueForm');
    const submitButton = document.querySelector('.submitbtn');
    
    // Initialize the first step as active
    initializeForm();
    
    // Set up next buttons with validation
    if (nextButtons.length > 0) {
        nextButtons.forEach((button, index) => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Validate current step before proceeding
                if (validateCurrentStep(index)) {
                    navigateToStep(index + 1);
                }
            });
        });
    }
    
    // Set up previous buttons
    if (prevButtons.length > 0) {
        prevButtons.forEach((button, index) => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const currentSection = button.closest('.form-section');
                const currentIndex = Array.from(formSections).indexOf(currentSection);
                navigateToStep(currentIndex - 1);
            });
        });
    }
    
    // Form submission handler
    if (venueForm) {
        venueForm.addEventListener('submit', function (event) {
            event.preventDefault();
            clearAllErrors();
            
            // Validate all steps before submission
            let allStepsValid = true;
            for (let i = 0; i < formSections.length; i++) {
                if (!validateCurrentStep(i)) {
                    allStepsValid = false;
                    // Show the step with errors
                    navigateToStep(i);
                    break;
                }
            }
            
            if (allStepsValid) {
                if (submitButton) {
                    submitButton.innerHTML = '<span class="spinner"></span> Adding Venue...';
                    submitButton.disabled = true;
                }
                this.submit();
            }
        });
    }
    
    // Set up input event listeners to clear errors when user corrects them
    setupInputListeners();
    
    // Initialize the form and override the global showStep function
    function initializeForm() {
        // Make the first step active
        if (formSections.length > 0) {
            formSections[0].classList.add('active');
        }
        if (stepButtons.length > 0) {
            stepButtons[0].classList.add('active');
        }
        
        // Override the global showStep function to include validation
        window.showStep = function(stepNumber) {
            // Convert from 1-based (HTML) to 0-based (JS array)
            const stepIndex = stepNumber - 1;
            
            // Get current step
            const currentActiveSection = document.querySelector('.form-section.active');
            const currentIndex = Array.from(formSections).indexOf(currentActiveSection);
            
            // If moving forward, validate each step in between
            if (stepIndex > currentIndex) {
                // Validate all steps from current to target
                for (let i = currentIndex; i < stepIndex; i++) {
                    if (!validateCurrentStep(i)) {
                        // Stop at the first invalid step
                        navigateToStep(i);
                        return false;
                    }
                }
                navigateToStep(stepIndex);
            } else {
                // Moving backward doesn't require validation
                navigateToStep(stepIndex);
            }
        };
    }
    
    // Function to navigate to a specific step without validation
    function navigateToStep(stepIndex) {
        // Hide all form sections and remove active class from step buttons
        formSections.forEach((section, idx) => {
            section.classList.remove('active');
        });
        
        stepButtons.forEach((button, idx) => {
            button.classList.remove('active');
        });
        
        // Show the current step and make its step button active
        if (stepIndex >= 0 && stepIndex < formSections.length) {
            formSections[stepIndex].classList.add('active');
            
            // Step buttons are 1-indexed in data-step
            const targetButton = document.querySelector(`.step[data-step="${stepIndex + 1}"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }
            
            // Update progress indicator
            updateProgressIndicator(stepIndex);
            
            // Scroll to top of the step
            window.scrollTo({
                top: formSections[stepIndex].offsetTop - 100,
                behavior: 'smooth'
            });
        }
    }
    
    // Function to update progress indicator
    function updateProgressIndicator(activeIndex) {
        stepButtons.forEach((step, index) => {
            if (index < activeIndex) {
                step.classList.add('completed');
                step.classList.remove('active');
            } else if (index === activeIndex) {
                step.classList.add('active');
                step.classList.remove('completed');
            } else {
                step.classList.remove('active', 'completed');
            }
        });
    }
    
    // Function to validate the current step
    function validateCurrentStep(stepIndex) {
        // Clear previous error messages
        clearAllErrors();
        
        // Determine which step to validate based on index
        if (stepIndex === 0) {
            // Basic Information validations
            return validateBasicInfo();
        } 
        else if (stepIndex === 1) {
            // Gallery validations
            return validateGallery();
        }
        else if (stepIndex === 2) {
            // Location validations
            return validateLocation();
        }
        
        return true; // Default valid for steps without validation
    }
    
    // Validate basic information section
    function validateBasicInfo() {
        let valid = true;
        
        const venueName = document.querySelector('input[name="name"]');
        if (!venueName.value.trim()) {
            showError(venueName, 'Venue name is required');
            valid = false;
        } else if (venueName.value.trim().length < 3) {
            showError(venueName, 'Venue name must be at least 3 characters');
            valid = false;
        }
        
        const description = document.querySelector('textarea[name="description"]');
        if (!description.value.trim()) {
            showError(description, 'Venue description is required');
            valid = false;
        } else if (description.value.trim().length < 20) {
            showError(description, 'Description must be at least 20 characters');
            valid = false;
        }
        
        const price = document.querySelector('input[name="price"]');
        if (!price.value) {
            showError(price, 'Price is required');
            valid = false;
        } else if (isNaN(price.value) || parseFloat(price.value) <= 0) {
            showError(price, 'Please enter a valid price greater than 0');
            valid = false;
        }
        
        const contact = document.querySelector('input[name="contact"]');
        if (!contact.value.trim()) {
            showError(contact, 'Contact information is required');
            valid = false;
        } else if (!validatePhone(contact.value)) {
            showError(contact, 'Please enter a valid phone number');
            valid = false;
        }
        
        const capacity = document.querySelector('input[name="capacity"]');
        if (!capacity.value) {
            showError(capacity, 'Capacity is required');
            valid = false;
        } else if (isNaN(capacity.value) || parseInt(capacity.value) <= 0) {
            showError(capacity, 'Capacity must be a positive number');
            valid = false;
        }
        
        // Check if at least one category is selected
        const categoriesSelected = validateCategories();
        if (!categoriesSelected) {
            const categoriesSection = document.querySelector('.outer_check');
            const categoryError = document.createElement('div');
            categoryError.className = 'form-error';
            categoryError.textContent = 'Please select at least one venue category';
            categoryError.style.color = '#d9534f';
            categoryError.style.marginTop = '5px';
            categoriesSection.appendChild(categoryError);
            valid = false;
        }
        
        return valid;
    }
    
    // Validate gallery section
    function validateGallery() {
        let valid = true;
        
        const thumbnail = document.querySelector('input[name="thumbnail"]');
        if (thumbnail.files.length === 0 && !thumbnailAlreadyExists()) {
            showError(thumbnail, 'Please upload a thumbnail image');
            valid = false;
        } else if (thumbnail.files.length > 0) {
            const file = thumbnail.files[0];
            if (!validateImageFile(file)) {
                showError(thumbnail, 'Please upload a valid image file (JPG, PNG, or GIF)');
                valid = false;
            }
        }
        
        // Validate gallery images
        const galleryInput = document.getElementById('galleryInput');
        if (galleryInput && galleryInput.files.length > 0) {
            const files = galleryInput.files;
            
            if (files.length > 4) {
                showError(galleryInput, 'You can upload a maximum of 4 gallery images');
                valid = false;
            }
            
            for (let i = 0; i < files.length; i++) {
                if (!validateImageFile(files[i])) {
                    showError(galleryInput, 'Please upload valid image files (JPG, PNG, or GIF)');
                    valid = false;
                    break;
                }
            }
        }
        
        return valid;
    }
    
    // Validate location section
    function validateLocation() {
        let valid = true;
        
        const fullAddress = document.querySelector('input[name="full_address"]');
        if (!fullAddress.value.trim()) {
            showError(fullAddress, 'Full address is required');
            valid = false;
        }
        
        const region = document.querySelector('input[name="region"]'); // <-- fixed here
        if (!region.value.trim()) {
            showError(region, 'Region is required');
            valid = false;
        }
        
        const longitude = document.querySelector('input[name="longitude"]');
        const latitude = document.querySelector('input[name="latitude"]');
        
        if (!longitude.value.trim()) {
            showError(longitude, 'Longitude is required');
            valid = false;
        } else if (!validateCoordinate(longitude.value, 'longitude')) {
            showError(longitude, 'Please enter a valid longitude (-180 to 180)');
            valid = false;
        }
        
        if (!latitude.value.trim()) {
            showError(latitude, 'Latitude is required');
            valid = false;
        } else if (!validateCoordinate(latitude.value, 'latitude')) {
            showError(latitude, 'Please enter a valid latitude (-90 to 90)');
            valid = false;
        }
        
        return valid;
    }
    
    
    // Function to show error under an input field
    function showError(element, message) {
        // Clear any existing error for this element
        const existingError = element.parentNode.querySelector('.form-error');
        if (existingError) {
            existingError.remove();
        }
        
        const errorDiv = document.createElement('div');
        errorDiv.className = 'form-error';
        errorDiv.textContent = message;
        errorDiv.style.color = '#d9534f';
        errorDiv.style.fontSize = '14px';
        errorDiv.style.marginTop = '5px';
        
        element.parentNode.insertBefore(errorDiv, element.nextSibling);
        element.style.borderColor = '#d9534f';
    }
    
    // Function to clear all error messages
    function clearAllErrors() {
        const errorElements = document.querySelectorAll('.form-error');
        errorElements.forEach(element => element.remove());
        
        // Reset input border colors
        const inputs = document.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            input.style.borderColor = '';
        });
    }
    
    // Function to set up input event listeners
    function setupInputListeners() {
        const inputs = document.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                this.style.borderColor = '';
                const errorMsg = this.parentNode.querySelector('.form-error');
                if (errorMsg) {
                    errorMsg.remove();
                }
            });
            
            // For checkboxes
            if (input.type === 'checkbox') {
                input.addEventListener('change', function() {
                    // If any category checkbox is checked, remove the error message
                    if (this.name.startsWith('is_') && this.checked) {
                        const categoriesSection = document.querySelector('.outer_check');
                        const errorMsg = categoriesSection.querySelector('.form-error');
                        if (errorMsg) {
                            errorMsg.remove();
                        }
                    }
                });
            }
        });
    }
    
    // Function to validate categories
    function validateCategories() {
        // Include all category checkboxes
        const categoryCheckboxes = [
            'is_beach', 'is_city', 'is_hotel', 'is_countryside',
            'is_mountain', 'is_resort', 'is_forest', 'is_rooftop', 'is_garden',
            'is_desert', 'is_lake', 'is_island', 'is_cave', 'is_vineyard'
        ];

        for (const category of categoryCheckboxes) {
            const checkbox = document.querySelector(`input[name="${category}"]`);
            if (checkbox && checkbox.checked) {
                return true;
            }
        }

        return false;
    }
    
    // Function to check if thumbnail already exists
    function thumbnailAlreadyExists() {
        // Look for an element that indicates an existing thumbnail
        const existingThumbnail = document.querySelector('.existing-thumbnail-indicator');
        return existingThumbnail !== null;
    }
    
    // Function to validate image file
    function validateImageFile(file) {
        const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/jpg'];
        return validTypes.includes(file.type);
    }
    
    // Function to validate coordinates
    function validateCoordinate(value, type) {
        const num = parseFloat(value);
        if (isNaN(num)) return false;
        
        if (type === 'latitude') {
            return num >= -90 && num <= 90;
        } else if (type === 'longitude') {
            return num >= -180 && num <= 180;
        }
        
        return false;
    }
    
    // Function to validate phone number
    function validatePhone(phone) {
        // Basic phone validation - can be customized based on your requirements
        // This pattern accepts formats like: +1234567890, 123-456-7890, (123)456-7890
        const phonePattern = /^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/;
        return phonePattern.test(phone);
    }
});
   </script>
    
</html>
